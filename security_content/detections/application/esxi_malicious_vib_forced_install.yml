name: ESXi Malicious VIB Forced Install
id: 5d4d2cd2-7b65-4474-97cf-e9b203bcd770
version: 2
date: '2025-08-06'
author: Raven Tait, Splunk
status: production
type: TTP
description: Detects potentially malicious installation of VMware Installation
  Bundles (VIBs) using the --force flag. The --force option bypasses signature
  and compatibility checks, allowing unsigned, community-supported, or
  incompatible VIBs to be installed on an ESXi host. This behavior is uncommon in
  normal administrative operations and is often observed in post-compromise
  scenarios where adversaries attempt to install backdoored or unauthorized kernel
  modules, drivers, or monitoring tools to establish persistence or gain deeper
  control of the hypervisor.
data_source:
  - VMWare ESXi Syslog
search: '`esxi_syslog` Message="* image profile with validation disabled. *" OR
  Message="* image profile bypassing signing and acceptance level verification.
  *" OR Message="* vib without valid signature, *"
  | rex field=_raw "Z (?<dest>[\w\.]+)\s"
  | stats min(_time) as firstTime max(_time) as lastTime count by dest Message
  | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`
  | `esxi_malicious_vib_forced_install_filter`'
how_to_implement:
  This is based on syslog data generated by VMware ESXi hosts. To implement this search,
  you must configure your ESXi systems to forward syslog output to your Splunk deployment. These logs must
  be ingested with the appropriate Splunk Technology Add-on for VMware ESXi Logs, which provides field
  extractions and CIM compatibility.
known_false_positives: Some third party vendor VIBs or patches may require the force option.
references:
  - https://detect.fyi/detecting-and-responding-to-esxi-compromise-with-splunk-f33998ce7823
drilldown_searches:
  - name: View the detection results for - "$dest$"
    search: '%original_detection_search% | search  dest = "$dest$"'
    earliest_offset: $info_min_time$
    latest_offset: $info_max_time$
  - name: View risk events for the last 7 days for - "$dest$"
    search:
      '| from datamodel Risk.All_Risk | search normalized_risk_object IN ("$dest$")
      starthoursago=168  | stats count min(_time) as firstTime max(_time) as lastTime
      values(search_name) as "Search Name" values(risk_message) as "Risk Message" values(analyticstories)
      as "Analytic Stories" values(annotations._all) as "Annotations" values(annotations.mitre_attack.mitre_tactic)
      as "ATT&CK Tactics" by normalized_risk_object | `security_content_ctime(firstTime)`
      | `security_content_ctime(lastTime)`'
    earliest_offset: $info_min_time$
    latest_offset: $info_max_time$
rba:
  message: A VIB was installed on ESXi $dest$ with the force flag.
  risk_objects:
    - field: dest
      type: system
      score: 60
  threat_objects: []
tags:
  analytic_story:
    - ESXi Post Compromise
    - Black Basta Ransomware
    - China-Nexus Threat Activity
  asset_type: Infrastructure
  mitre_attack_id:
    - T1505.006
  product:
    - Splunk Enterprise
    - Splunk Enterprise Security
    - Splunk Cloud
  security_domain: endpoint
tests:
  - name: True Positive Test
    attack_data:
      - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1505.006/esxi_malicious_vib/esxi_malicious_vib_forced_install.log
        source: vmware:esxlog
        sourcetype: vmw-syslog
