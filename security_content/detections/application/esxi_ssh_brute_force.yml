name: ESXi SSH Brute Force
id: 68fe4efa-bbbb-44ee-9f09-d07d2f0f346b
version: 1
date: '2025-05-12'
author: Raven Tait, Splunk
status: production
type: Anomaly
description:
  This detection identifies signs of SSH brute-force attacks by monitoring for a high
  number of failed login attempts within a short time frame. Such activity may indicate an
  attacker attempting to gain unauthorized access through password guessing.
data_source:
  - VMWare ESXi Syslog
search: '`esxi_syslog` Message="*Authentication failure for*"
  | rex "for (?<user>[\w]+) from (?<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})"
  | rex field=_raw "Z (?<dest>[\w\.]+)\s"
  | bin _time span=5m
  | stats min(_time) as firstTime max(_time) as lastTime count by user, src_ip, dest
  | where count > 10
  | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`
  | `esxi_ssh_brute_force_filter`'
how_to_implement:
  This is based on syslog data generated by VMware ESXi hosts. To implement this search,
  you must configure your ESXi systems to forward syslog output to your Splunk deployment. These logs must
  be ingested with the appropriate Splunk Technology Add-on for VMware ESXi Logs, which provides field
  extractions and CIM compatibility.
known_false_positives:
  Limited false positives in most environments, however tune
  as needed.
drilldown_searches:
  - name: View the detection results for - "$dest$"
    search: '%original_detection_search% | search  dest = "$dest$"'
    earliest_offset: $info_min_time$
    latest_offset: $info_max_time$
  - name: View risk events for the last 7 days for - "$dest$"
    search:
      '| from datamodel Risk.All_Risk | search normalized_risk_object IN ("$dest$")
      starthoursago=168  | stats count min(_time) as firstTime max(_time) as lastTime
      values(search_name) as "Search Name" values(risk_message) as "Risk Message" values(analyticstories)
      as "Analytic Stories" values(annotations._all) as "Annotations" values(annotations.mitre_attack.mitre_tactic)
      as "ATT&CK Tactics" by normalized_risk_object | `security_content_ctime(firstTime)`
      | `security_content_ctime(lastTime)`'
    earliest_offset: $info_min_time$
    latest_offset: $info_max_time$
rba:
  message: Attempted SSH brute force on ESXi host $dest$.
  risk_objects:
    - field: dest
      type: system
      score: 25
  threat_objects: []
tags:
  analytic_story:
    - ESXi Post Compromise
    - Black Basta Ransomware
  asset_type: Infrastructure
  mitre_attack_id:
    - T1110
  product:
    - Splunk Enterprise
    - Splunk Enterprise Security
    - Splunk Cloud
  security_domain: endpoint
tests:
  - name: True Positive Test
    attack_data:
      - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1110/esxi_ssh_brute_force/esxi_ssh_brute_force.log
        source: vmware:esxlog
        sourcetype: vmw-syslog
