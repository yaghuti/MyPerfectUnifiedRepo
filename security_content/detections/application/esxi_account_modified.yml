name: ESXi Account Modified
id: b5e3b024-a7bb-4019-8975-46cf54485e78
version: 1
date: '2025-07-01'
author: Raven Tait, Splunk
status: production
type: Anomaly
description: This detection identifies the creation, deletion, or modification of a local user account on an ESXi host.
  This activity may indicate unauthorized access, indicator removal, or persistence attempts by an attacker seeking 
  to establish or maintain control of the host.
data_source:
- VMWare ESXi Syslog
search: '`esxi_syslog` Message="*esxcli system account*" Message IN ("*-i *","*--id*") NOT Message="*[shell*"
  | rex field=_raw "Z (?<dest>[\w\.]+)\s.*: \[(?<initial_user>\w+)]:\s.+-i[d]*\s(?<modified_user>[\w_\-0-9]+)"
  | stats min(_time) as firstTime max(_time) as lastTime count by dest initial_user modified_user 
  | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)`
  | `esxi_account_modified_filter`'
how_to_implement: This is based on syslog data generated by VMware ESXi hosts. To implement this search, 
  you must configure your ESXi systems to forward syslog output to your Splunk deployment. These logs must 
  be ingested with the appropriate Splunk Technology Add-on for VMware ESXi Logs, which provides field
  extractions and CIM compatibility. 
known_false_positives: New local accounts being created in ESXi is rare in most environments. Tune as needed.
references:
- https://detect.fyi/detecting-and-responding-to-esxi-compromise-with-splunk-f33998ce7823
drilldown_searches:
- name: View the detection results for - "$dest$"
  search: '%original_detection_search% | search  dest = "$dest$"'
  earliest_offset: $info_min_time$
  latest_offset: $info_max_time$
- name: View risk events for the last 7 days for - "$dest$"
  search: '| from datamodel Risk.All_Risk | search normalized_risk_object IN ("$dest$")
    starthoursago=168  | stats count min(_time) as firstTime max(_time) as lastTime
    values(search_name) as "Search Name" values(risk_message) as "Risk Message" values(analyticstories)
    as "Analytic Stories" values(annotations._all) as "Annotations" values(annotations.mitre_attack.mitre_tactic)
    as "ATT&CK Tactics" by normalized_risk_object | `security_content_ctime(firstTime)`
    | `security_content_ctime(lastTime)`'
  earliest_offset: $info_min_time$
  latest_offset: $info_max_time$
rba:
  message: Local account created, deleted, or modified on ESXi $dest$.
  risk_objects:
  - field: dest
    type: system
    score: 60
  threat_objects: []
tags:
  analytic_story:
  - ESXi Post Compromise
  - Black Basta Ransomware
  asset_type: Infrastructure
  mitre_attack_id:
  - T1136.001
  - T1078
  - T1098
  product:
  - Splunk Enterprise
  - Splunk Enterprise Security
  - Splunk Cloud
  security_domain: endpoint
tests:
- name: True Positive Test
  attack_data:
  - data: https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1098/esxi_account_modification/esxi_account_modified.log
    source: vmware:esxlog
    sourcetype: vmw-syslog
